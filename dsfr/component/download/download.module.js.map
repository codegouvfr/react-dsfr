{"version":3,"file":"download.module.js","sources":["../../../.config/config.js","../../../src/core/api.js","../../../src/component/download/script/download/download-selector.js","../../../src/component/download/script/download/assess-file.js","../../../src/component/download/index.js","../../../src/component/download/main.js"],"sourcesContent":["const config = {\r\n  prefix: 'fr',\r\n  namespace: 'dsfr',\r\n  organisation: '@gouvfr',\r\n  version: '1.9.3'\r\n};\r\n\r\nexport default config;\r\n","import config from './config.js';\nconst api = window[config.namespace];\nexport default api;\n","import api from '../../api.js';\n\nexport const DownloadSelector = {\n  DOWNLOAD_ASSESS_FILE: `${api.internals.ns.attr.selector('assess-file')}`,\n  DOWNLOAD_DETAIL: `${api.internals.ns.selector('download__detail')}`\n};\n","import api from '../../api.js';\nimport { DownloadSelector } from './download-selector';\n\nclass AssessFile extends api.core.Instance {\n  static get instanceClassName () {\n    return 'AssessFile';\n  }\n\n  init () {\n    this.lang = this.getLang(this.node);\n    this.href = this.getAttribute('href');\n\n    this.hreflang = this.getAttribute('hreflang');\n    this.file = {};\n    this.detail = this.querySelector(DownloadSelector.DOWNLOAD_DETAIL);\n    this.update();\n  }\n\n  getFileLength () {\n    if (this.href === undefined) {\n      this.length = -1;\n      return;\n    }\n\n    fetch(this.href, { method: 'HEAD', mode: 'cors' }).then(response => {\n      this.length = response.headers.get('content-length') || -1;\n      if (this.length === -1) {\n        api.inspector.warn('File size unknown: ' + this.href + '\\nUnable to get HTTP header: \"content-length\"');\n      }\n      this.update();\n    });\n  }\n\n  update () {\n    // TODO V2: implémenter async\n    if (this.isLegacy) this.length = -1;\n\n    if (!this.length) {\n      this.getFileLength();\n      return;\n    }\n\n    const details = [];\n    if (this.detail) {\n      if (this.href) {\n        const extension = this.parseExtension(this.href);\n        if (extension) details.push(extension.toUpperCase());\n      }\n\n      if (this.length !== -1) {\n        details.push(this.bytesToSize(this.length));\n      }\n\n      if (this.hreflang) {\n        details.push(this.getLangDisplayName(this.hreflang));\n      }\n\n      this.detail.innerHTML = details.join(' - ');\n    }\n  }\n\n  getLang (elem) {\n    if (elem.lang) return elem.lang;\n    if (document.documentElement === elem) return window.navigator.language;\n    return this.getLang(elem.parentElement);\n  }\n\n  parseExtension (url) {\n    const regexExtension = /\\.(\\w{1,9})(?:$|[?#])/;\n    return url.match(regexExtension)[0].replace('.', '');\n  }\n\n  getLangDisplayName (locale) {\n    if (this.isLegacy) return locale;\n    const displayNames = new Intl.DisplayNames([this.lang], { type: 'language' });\n    const name = displayNames.of(locale);\n    return name.charAt(0).toUpperCase() + name.slice(1);\n  }\n\n  bytesToSize (bytes) {\n    if (bytes === -1) return null;\n\n    let sizeUnits = ['octets', 'ko', 'Mo', 'Go', 'To'];\n    if (this.getAttribute(api.internals.ns.attr('assess-file')) === 'bytes') {\n      sizeUnits = ['bytes', 'KB', 'MB', 'GB', 'TB'];\n    }\n\n    const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1000)), 10);\n    if (i === 0) return `${bytes} ${sizeUnits[i]}`;\n\n    const size = bytes / (1000 ** i);\n    const roundedSize = Math.round((size + Number.EPSILON) * 100) / 100; // arrondi a 2 décimal\n    const stringSize = String(roundedSize).replace('.', ',');\n\n    return `${stringSize} ${sizeUnits[i]}`;\n  }\n}\n\nexport { AssessFile };\n","import api from './api.js';\nimport { AssessFile } from './script/download/assess-file.js';\nimport { DownloadSelector } from './script/download/download-selector';\n\napi.download = {\n  DownloadSelector: DownloadSelector,\n  AssessFile: AssessFile\n\n};\n\nexport default api;\n","import api from './index.js';\n\napi.internals.register(api.download.DownloadSelector.DOWNLOAD_ASSESS_FILE, api.download.AssessFile);\n\nexport default api;\n"],"names":[],"mappings":"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"}