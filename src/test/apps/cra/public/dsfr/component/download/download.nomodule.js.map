{"version":3,"file":"download.nomodule.js","sources":["../../../.config/config.js","../../../src/core/api.js","../../../src/component/download/script/download/download-selector.js","../../../src/component/download/script/download/assess-file.js","../../../src/component/download/index.js","../../../src/component/download/main.js"],"sourcesContent":["const config = {\r\n  prefix: 'fr',\r\n  namespace: 'dsfr',\r\n  organisation: '@gouvfr',\r\n  version: '1.7.2'\r\n};\r\n\r\nexport default config;\r\n","import config from './config.js';\nconst api = window[config.namespace];\nexport default api;\n","import api from '../../api.js';\n\nexport const DownloadSelector = {\n  DOWNLOAD_ASSESS_FILE: `${api.internals.ns.attr.selector('assess-file')}`,\n  DOWNLOAD_DETAIL: `${api.internals.ns.selector('download__detail')}`\n};\n","import api from '../../api.js';\nimport { DownloadSelector } from './download-selector';\n\nclass AssessFile extends api.core.Instance {\n  static get instanceClassName () {\n    return 'AssessFile';\n  }\n\n  init () {\n    this.lang = this.getLang(this.node);\n    this.href = this.getAttribute('href');\n\n    this.hreflang = this.getAttribute('hreflang');\n    this.file = {};\n    this.detail = this.querySelector(DownloadSelector.DOWNLOAD_DETAIL);\n    this.update();\n  }\n\n  getFileLength () {\n    if (this.href === undefined) {\n      this.length = -1;\n      return;\n    }\n\n    fetch(this.href, { method: 'HEAD', mode: 'cors' }).then(response => {\n      this.length = response.headers.get('content-length') || -1;\n      if (this.length === -1) {\n        console.warn('Impossible de détecter le poids du fichier ' + this.href + '\\nErreur de récupération de l\\'en-tête HTTP : \"content-length\"');\n      }\n      this.update();\n    });\n  }\n\n  update () {\n    // TODO V2: implémenter async\n    if (this.isLegacy) this.length = -1;\n\n    if (!this.length) {\n      this.getFileLength();\n      return;\n    }\n\n    const details = [];\n    if (this.detail) {\n      if (this.href) {\n        const extension = this.parseExtension(this.href);\n        if (extension) details.push(extension.toUpperCase());\n      }\n\n      if (this.length !== -1) {\n        details.push(this.bytesToSize(this.length));\n      }\n\n      if (this.hreflang) {\n        details.push(this.getLangDisplayName(this.hreflang));\n      }\n\n      this.detail.innerHTML = details.join(' - ');\n    }\n  }\n\n  getLang (elem) {\n    if (elem.lang) return elem.lang;\n    if (document.documentElement === elem) return window.navigator.language;\n    return this.getLang(elem.parentElement);\n  }\n\n  parseExtension (url) {\n    const regexExtension = /\\.(\\w{1,9})(?:$|[?#])/;\n    return url.match(regexExtension)[0].replace('.', '');\n  }\n\n  getLangDisplayName (locale) {\n    if (this.isLegacy) return locale;\n    const displayNames = new Intl.DisplayNames([this.lang], { type: 'language' });\n    const name = displayNames.of(locale);\n    return name.charAt(0).toUpperCase() + name.slice(1);\n  }\n\n  bytesToSize (bytes) {\n    if (bytes === -1) return null;\n\n    let sizeUnits = ['octets', 'ko', 'Mo', 'Go', 'To'];\n    if (this.getAttribute(api.internals.ns.attr('assess-file')) === 'bytes') {\n      sizeUnits = ['bytes', 'KB', 'MB', 'GB', 'TB'];\n    }\n\n    const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1000)), 10);\n    if (i === 0) return `${bytes} ${sizeUnits[i]}`;\n\n    const size = bytes / (1000 ** i);\n    const roundedSize = Math.round((size + Number.EPSILON) * 100) / 100; // arrondi a 2 décimal\n    const stringSize = String(roundedSize).replace('.', ',');\n\n    return `${stringSize} ${sizeUnits[i]}`;\n  }\n}\n\nexport { AssessFile };\n","import api from './api.js';\nimport { AssessFile } from './script/download/assess-file.js';\nimport { DownloadSelector } from './script/download/download-selector';\n\napi.download = {\n  DownloadSelector: DownloadSelector,\n  AssessFile: AssessFile\n\n};\n\nexport default api;\n","import api from './index.js';\n\napi.internals.register(api.download.DownloadSelector.DOWNLOAD_ASSESS_FILE, api.download.AssessFile);\n\nexport default api;\n"],"names":["const","this","let"],"mappings":"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"}