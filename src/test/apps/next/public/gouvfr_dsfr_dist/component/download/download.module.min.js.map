{"version":3,"file":"download.module.min.js","sources":["../../../.config/config.js","../../../src/core/api.js","../../../src/component/download/script/download/download-selector.js","../../../src/component/download/script/download/assess-file.js","../../../src/component/download/index.js","../../../src/component/download/main.js"],"sourcesContent":["const config = {\r\n  prefix: 'fr',\r\n  namespace: 'dsfr',\r\n  organisation: '@gouvfr',\r\n  version: '1.7.2'\r\n};\r\n\r\nexport default config;\r\n","import config from './config.js';\nconst api = window[config.namespace];\nexport default api;\n","import api from '../../api.js';\n\nexport const DownloadSelector = {\n  DOWNLOAD_ASSESS_FILE: `${api.internals.ns.attr.selector('assess-file')}`,\n  DOWNLOAD_DETAIL: `${api.internals.ns.selector('download__detail')}`\n};\n","import api from '../../api.js';\nimport { DownloadSelector } from './download-selector';\n\nclass AssessFile extends api.core.Instance {\n  static get instanceClassName () {\n    return 'AssessFile';\n  }\n\n  init () {\n    this.lang = this.getLang(this.node);\n    this.href = this.getAttribute('href');\n\n    this.hreflang = this.getAttribute('hreflang');\n    this.file = {};\n    this.detail = this.querySelector(DownloadSelector.DOWNLOAD_DETAIL);\n    this.update();\n  }\n\n  getFileLength () {\n    if (this.href === undefined) {\n      this.length = -1;\n      return;\n    }\n\n    fetch(this.href, { method: 'HEAD', mode: 'cors' }).then(response => {\n      this.length = response.headers.get('content-length') || -1;\n      if (this.length === -1) {\n        console.warn('Impossible de détecter le poids du fichier ' + this.href + '\\nErreur de récupération de l\\'en-tête HTTP : \"content-length\"');\n      }\n      this.update();\n    });\n  }\n\n  update () {\n    // TODO V2: implémenter async\n    if (this.isLegacy) this.length = -1;\n\n    if (!this.length) {\n      this.getFileLength();\n      return;\n    }\n\n    const details = [];\n    if (this.detail) {\n      if (this.href) {\n        const extension = this.parseExtension(this.href);\n        if (extension) details.push(extension.toUpperCase());\n      }\n\n      if (this.length !== -1) {\n        details.push(this.bytesToSize(this.length));\n      }\n\n      if (this.hreflang) {\n        details.push(this.getLangDisplayName(this.hreflang));\n      }\n\n      this.detail.innerHTML = details.join(' - ');\n    }\n  }\n\n  getLang (elem) {\n    if (elem.lang) return elem.lang;\n    if (document.documentElement === elem) return window.navigator.language;\n    return this.getLang(elem.parentElement);\n  }\n\n  parseExtension (url) {\n    const regexExtension = /\\.(\\w{1,9})(?:$|[?#])/;\n    return url.match(regexExtension)[0].replace('.', '');\n  }\n\n  getLangDisplayName (locale) {\n    if (this.isLegacy) return locale;\n    const displayNames = new Intl.DisplayNames([this.lang], { type: 'language' });\n    const name = displayNames.of(locale);\n    return name.charAt(0).toUpperCase() + name.slice(1);\n  }\n\n  bytesToSize (bytes) {\n    if (bytes === -1) return null;\n\n    let sizeUnits = ['octets', 'ko', 'Mo', 'Go', 'To'];\n    if (this.getAttribute(api.internals.ns.attr('assess-file')) === 'bytes') {\n      sizeUnits = ['bytes', 'KB', 'MB', 'GB', 'TB'];\n    }\n\n    const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1000)), 10);\n    if (i === 0) return `${bytes} ${sizeUnits[i]}`;\n\n    const size = bytes / (1000 ** i);\n    const roundedSize = Math.round((size + Number.EPSILON) * 100) / 100; // arrondi a 2 décimal\n    const stringSize = String(roundedSize).replace('.', ',');\n\n    return `${stringSize} ${sizeUnits[i]}`;\n  }\n}\n\nexport { AssessFile };\n","import api from './api.js';\nimport { AssessFile } from './script/download/assess-file.js';\nimport { DownloadSelector } from './script/download/download-selector';\n\napi.download = {\n  DownloadSelector: DownloadSelector,\n  AssessFile: AssessFile\n\n};\n\nexport default api;\n","import api from './index.js';\n\napi.internals.register(api.download.DownloadSelector.DOWNLOAD_ASSESS_FILE, api.download.AssessFile);\n\nexport default api;\n"],"names":["api","window","DownloadSelector","DOWNLOAD_ASSESS_FILE","internals","ns","attr","selector","DOWNLOAD_DETAIL","AssessFile","core","Instance","instanceClassName","init","this","lang","getLang","node","href","getAttribute","hreflang","file","detail","querySelector","update","getFileLength","undefined","fetch","method","mode","then","response","length","headers","get","console","warn","isLegacy","details","extension","parseExtension","push","toUpperCase","bytesToSize","getLangDisplayName","innerHTML","join","elem","document","documentElement","navigator","language","parentElement","url","match","replace","locale","name","Intl","DisplayNames","type","of","charAt","slice","bytes","sizeUnits","i","parseInt","Math","floor","log","size","roundedSize","round","Number","EPSILON","String","download","register"],"mappings":";AAAA,MCCMA,EAAMC,OAAuB,KCCtBC,EAAmB,CAC9BC,qBAAsB,GAAGH,EAAII,UAAUC,GAAGC,KAAKC,SAAS,iBACxDC,gBAAiB,GAAGR,EAAII,UAAUC,GAAGE,SAAS,uBCDhD,MAAME,UAAmBT,EAAIU,KAAKC,SACrBC,+BACT,MAAO,aAGTC,OACEC,KAAKC,KAAOD,KAAKE,QAAQF,KAAKG,MAC9BH,KAAKI,KAAOJ,KAAKK,aAAa,QAE9BL,KAAKM,SAAWN,KAAKK,aAAa,YAClCL,KAAKO,KAAO,GACZP,KAAKQ,OAASR,KAAKS,cAAcrB,EAAiBM,iBAClDM,KAAKU,SAGPC,qBACoBC,IAAdZ,KAAKI,KAKTS,MAAMb,KAAKI,KAAM,CAAEU,OAAQ,OAAQC,KAAM,SAAUC,MAAKC,IACtDjB,KAAKkB,OAASD,EAASE,QAAQC,IAAI,oBAAsB,GACpC,IAAjBpB,KAAKkB,QACPG,QAAQC,KAAK,8CAAgDtB,KAAKI,KAAO,kEAE3EJ,KAAKU,YATLV,KAAKkB,QAAU,EAanBR,SAIE,GAFIV,KAAKuB,WAAUvB,KAAKkB,QAAU,IAE7BlB,KAAKkB,OAER,YADAlB,KAAKW,gBAIP,MAAMa,EAAU,GAChB,GAAIxB,KAAKQ,OAAQ,CACf,GAAIR,KAAKI,KAAM,CACb,MAAMqB,EAAYzB,KAAK0B,eAAe1B,KAAKI,MACvCqB,GAAWD,EAAQG,KAAKF,EAAUG,gBAGnB,IAAjB5B,KAAKkB,QACPM,EAAQG,KAAK3B,KAAK6B,YAAY7B,KAAKkB,SAGjClB,KAAKM,UACPkB,EAAQG,KAAK3B,KAAK8B,mBAAmB9B,KAAKM,WAG5CN,KAAKQ,OAAOuB,UAAYP,EAAQQ,KAAK,QAIzC9B,QAAS+B,GACP,OAAIA,EAAKhC,KAAagC,EAAKhC,KACvBiC,SAASC,kBAAoBF,EAAa9C,OAAOiD,UAAUC,SACxDrC,KAAKE,QAAQ+B,EAAKK,eAG3BZ,eAAgBa,GAEd,OAAOA,EAAIC,MADY,yBACU,GAAGC,QAAQ,IAAK,IAGnDX,mBAAoBY,GAClB,GAAI1C,KAAKuB,SAAU,OAAOmB,EAC1B,MACMC,EADe,IAAIC,KAAKC,aAAa,CAAC7C,KAAKC,MAAO,CAAE6C,KAAM,aACtCC,GAAGL,GAC7B,OAAOC,EAAKK,OAAO,GAAGpB,cAAgBe,EAAKM,MAAM,GAGnDpB,YAAaqB,GACX,IAAe,IAAXA,EAAc,OAAO,KAEzB,IAAIC,EAAY,CAAC,SAAU,KAAM,KAAM,KAAM,MACmB,UAA5DnD,KAAKK,aAAanB,EAAII,UAAUC,GAAGC,KAAK,kBAC1C2D,EAAY,CAAC,QAAS,KAAM,KAAM,KAAM,OAG1C,MAAMC,EAAIC,SAASC,KAAKC,MAAMD,KAAKE,IAAIN,GAASI,KAAKE,IAAI,MAAQ,IACjE,GAAU,IAANJ,EAAS,MAAO,GAAGF,KAASC,EAAUC,KAE1C,MAAMK,EAAOP,EAAS,KAAQE,EACxBM,EAAcJ,KAAKK,MAAgC,KAAzBF,EAAOG,OAAOC,UAAkB,IAGhE,MAAO,GAFYC,OAAOJ,GAAajB,QAAQ,IAAK,QAE5BU,EAAUC,MC1FtClE,EAAI6E,SAAW,CACb3E,iBAAkBA,EAClBO,WAAYA,GCJdT,EAAII,UAAU0E,SAAS9E,EAAI6E,SAAS3E,iBAAiBC,qBAAsBH,EAAI6E,SAASpE"}